<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  

  
  <title>zhoujie&#39;s blog</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta property="og:type" content="website">
<meta property="og:title" content="zhoujie&#39;s blog">
<meta property="og:url" content="http:&#x2F;&#x2F;yoursite.com&#x2F;index.html">
<meta property="og:site_name" content="zhoujie&#39;s blog">
<meta property="og:locale" content="en_US">
<meta property="article:author" content="zhoujie">
<meta name="twitter:card" content="summary">
  
    <link rel="alternate" href="/atom.xml" title="zhoujie&#39;s blog" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  
    <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  
  
<link rel="stylesheet" href="/css/style.css">

<meta name="generator" content="Hexo 4.1.1"></head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">zhoujie&#39;s blog</a>
      </h1>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="Search"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://yoursite.com"></form>
      </div>
    </div>
  </div>
</header>
      <div class="outer">
        <section id="main">
  
    <article id="post-webpack原理浅析之打包优化" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2019/12/13/webpack%E5%8E%9F%E7%90%86%E6%B5%85%E6%9E%90%E4%B9%8B%E6%89%93%E5%8C%85%E4%BC%98%E5%8C%96/" class="article-date">
  <time datetime="2019-12-13T03:38:31.000Z" itemprop="datePublished">2019-12-13</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2019/12/13/webpack%E5%8E%9F%E7%90%86%E6%B5%85%E6%9E%90%E4%B9%8B%E6%89%93%E5%8C%85%E4%BC%98%E5%8C%96/">webpack原理浅析之打包优化</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="一-DLL-动态链接库"><a href="#一-DLL-动态链接库" class="headerlink" title="一. DLL(动态链接库)"></a>一. DLL(动态链接库)</h2><h3 id="1-为什么需要dll"><a href="#1-为什么需要dll" class="headerlink" title="1.为什么需要dll"></a>1.为什么需要dll</h3><p>Webpack的打包构建速度会随着引入的库的数量增加而变的越来越慢，一些体积比较大的第三方库是构建速度慢的主要原因。<br>虽然我们有code split方案，但是代码分割后每次打包还是要去处理这些第三方库。<br>在开发中，每次我们修改源代码，连带着没有改动的第三方库也会被重新编译打包，这是我们不想看到的。</p>
<p>DLL就是Webpack提供的专门为我们解决这个问题的神器。</p>
<p>DllPlugin结合DllRefrencePlugin插件的运用，对将要产出的bundle文件进行拆解打包，可以很彻底地加快webpack的打包速度，从而在开发过程中极大地缩减构建时间。</p>
<p>其主要原理是： DLLPlugin 它能把第三方库代码分离开，并且每次文件更改的时候，它只会打包该项目自身的代码。所以打包速度会更快。</p>
<h3 id="2-如何使用"><a href="#2-如何使用" class="headerlink" title="2.如何使用"></a>2.如何使用</h3><p>DLLPlugin 这个插件是在一个额外独立的webpack设置中创建一个只有dll的bundle，也就是说我们在项目根目录下除了有webpack.config.js，还会新建一个webpack.dll.config.js文件。<br>webpack.dll.config.js作用是把所有的第三方库依赖打包到一个bundle的dll文件里面，还会生成一个名为 manifest.json文件。<br>该manifest.json的作用是用来让 DllReferencePlugin 映射到相关的依赖上去的。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">&#x2F;&#x2F; webpack.dll.config.js</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">const webpack &#x3D; require(&#39;webpack&#39;);</span><br><span class="line">&#x2F;&#x2F; 需要单独打包的第三方库</span><br><span class="line">const vendors &#x3D; [</span><br><span class="line">  &#39;antd&#39;,</span><br><span class="line">  &#39;isomorphic-fetch&#39;,</span><br><span class="line">  &#39;react&#39;,</span><br><span class="line">  &#39;react-dom&#39;,</span><br><span class="line">  &#39;react-redux&#39;,</span><br><span class="line">  &#39;react-router&#39;,</span><br><span class="line">  &#39;redux&#39;,</span><br><span class="line">  &#39;redux-promise-middleware&#39;,</span><br><span class="line">  &#39;redux-thunk&#39;,</span><br><span class="line">  &#39;superagent&#39;,</span><br><span class="line">]; </span><br><span class="line"></span><br><span class="line">module.exports &#x3D; &#123;</span><br><span class="line">  output: &#123;</span><br><span class="line">    path: &#39;build&#39;,</span><br><span class="line">    filename: &#39;[name].[chunkhash].js&#39;,</span><br><span class="line">    library: &#39;[name]_[chunkhash]&#39;,</span><br><span class="line">  &#125;,</span><br><span class="line">  entry: &#123;</span><br><span class="line">    vendor: vendors,</span><br><span class="line">  &#125;,</span><br><span class="line">  plugins: [</span><br><span class="line">    new webpack.DllPlugin(&#123;</span><br><span class="line">      path: &#39;manifest.json&#39;, &#x2F;&#x2F; manifest文件的输出路径</span><br><span class="line">      name: &#39;[name]_[chunkhash]&#39;, &#x2F;&#x2F; dll暴露的对象名 要跟output.library保持一致</span><br><span class="line">      context: __dirname, &#x2F;&#x2F; 解析包路径的上下文 ，这个要跟接下来配置的dll user一致</span><br><span class="line">    &#125;),</span><br><span class="line">  ],</span><br><span class="line">&#125;;</span><br><span class="line">运行Webpack dll配置，会输出两个文件，一个是打包好的vendor.js，一个就是manifest.json.</span><br><span class="line"></span><br><span class="line">&#x2F;&#x2F; manifest.json</span><br><span class="line">&#123;</span><br><span class="line">  &quot;name&quot;: &quot;vendor_ac51ba426d4f259b8b18&quot;,</span><br><span class="line">  &quot;content&quot;: &#123;</span><br><span class="line">    &quot;.&#x2F;node_modules&#x2F;antd&#x2F;dist&#x2F;antd.js&quot;: 1,</span><br><span class="line">    &quot;.&#x2F;node_modules&#x2F;react&#x2F;react.js&quot;: 2,</span><br><span class="line">    &quot;.&#x2F;node_modules&#x2F;react&#x2F;lib&#x2F;React.js&quot;: 3,</span><br><span class="line">    &quot;.&#x2F;node_modules&#x2F;react&#x2F;node_modules&#x2F;object-assign&#x2F;index.js&quot;: 4,</span><br><span class="line">    &quot;.&#x2F;node_modules&#x2F;react&#x2F;lib&#x2F;ReactChildren.js&quot;: 5,</span><br><span class="line">    &quot;.&#x2F;node_modules&#x2F;react&#x2F;lib&#x2F;PooledClass.js&quot;: 6,</span><br><span class="line">    &quot;.&#x2F;node_modules&#x2F;react&#x2F;lib&#x2F;reactProdInvariant.js&quot;: 7,</span><br><span class="line">    &quot;.&#x2F;node_modules&#x2F;fbjs&#x2F;lib&#x2F;invariant.js&quot;: 8,</span><br><span class="line">    &quot;.&#x2F;node_modules&#x2F;react&#x2F;lib&#x2F;ReactElement.js&quot;: 9,</span><br><span class="line">    </span><br><span class="line">    ............</span><br><span class="line">Webpack将每个库都进行了编号索引，之后的dll user可以读取这个文件，直接用id来引用。</span><br><span class="line"></span><br><span class="line">&#x2F;&#x2F; webpack.config.js</span><br><span class="line"></span><br><span class="line">const webpack &#x3D; require(&#39;webpack&#39;);</span><br><span class="line"></span><br><span class="line">module.exports &#x3D; &#123;</span><br><span class="line">  output: &#123;</span><br><span class="line">    path: &#39;build&#39;,</span><br><span class="line">    filename: &#39;[name].[chunkhash].js&#39;,</span><br><span class="line">  &#125;,</span><br><span class="line">  entry: &#123;</span><br><span class="line">    app: &#39;.&#x2F;src&#x2F;index.js&#39;,</span><br><span class="line">  &#125;,</span><br><span class="line">  plugins: [</span><br><span class="line">    new webpack.DllReferencePlugin(&#123;</span><br><span class="line">      context: __dirname, &#x2F;&#x2F; 需要跟之前保持一致</span><br><span class="line">      manifest: require(&#39;.&#x2F;manifest.json&#39;),&#x2F;&#x2F; 用来引入刚才输出的manifest文件</span><br><span class="line">    &#125;),</span><br><span class="line">  ],</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>运行webpack，会发现生成的包和构建速度都有了一个质的提升。</p>
<h2 id="二-HappyPack——提升构建速度"><a href="#二-HappyPack——提升构建速度" class="headerlink" title="二.HappyPack——提升构建速度"></a>二.HappyPack——提升构建速度</h2><p>webpack需要处理的文件是非常多的，构建过程是一个涉及大量文件读写的过程。项目复杂起来了，文件数量变多之后，webpack构建就会特别慢。<br>由于运行在 Node.js 之上的 Webpack 是单线程模型的，所以Webpack 需要处理的事情需要一件一件的做，不能多件事一起做。<br>我们需要Webpack 能同一时间处理多个任务，发挥多核 CPU 电脑的威力，HappyPack 就能让 Webpack 做到这点，它把任务分解给多个子进程去并发的执行，子进程处理完后再把结果发送给主进程。</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2019/12/13/webpack%E5%8E%9F%E7%90%86%E6%B5%85%E6%9E%90%E4%B9%8B%E6%89%93%E5%8C%85%E4%BC%98%E5%8C%96/" data-id="ck43m2ejg0004sf0o20gdbu95" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-webpack原理浅析之代码分割" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2019/12/13/webpack%E5%8E%9F%E7%90%86%E6%B5%85%E6%9E%90%E4%B9%8B%E4%BB%A3%E7%A0%81%E5%88%86%E5%89%B2/" class="article-date">
  <time datetime="2019-12-13T03:37:54.000Z" itemprop="datePublished">2019-12-13</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2019/12/13/webpack%E5%8E%9F%E7%90%86%E6%B5%85%E6%9E%90%E4%B9%8B%E4%BB%A3%E7%A0%81%E5%88%86%E5%89%B2/">webpack原理浅析之代码分割</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>code splitting是webpack最引人注目的特性之一。他可以把代码分离到不同的bundle中，然后可以按需加载或并行加载这些文件。</p>
<h2 id="一-可以实现代码分割的方式"><a href="#一-可以实现代码分割的方式" class="headerlink" title="一.可以实现代码分割的方式"></a>一.可以实现代码分割的方式</h2><h3 id="1-入口起点：使用-entry-配置手动地分离代码。"><a href="#1-入口起点：使用-entry-配置手动地分离代码。" class="headerlink" title="1.入口起点：使用 entry 配置手动地分离代码。"></a>1.入口起点：使用 entry 配置手动地分离代码。</h3><p>这是迄今为止最简单、最直观的分离代码的方式。不过，这种方式手动配置较多，并有一些隐患：</p>
<p>如果入口 chunk 之间包含一些重复的模块，那些重复模块都会被引入到各个 bundle 中。<br>这种方法不够灵活，并且不能动态地将核心应用程序逻辑中的代码拆分出来。</p>
<h3 id="2-SplitChunksPlugin"><a href="#2-SplitChunksPlugin" class="headerlink" title="2.SplitChunksPlugin"></a>2.SplitChunksPlugin</h3><p>SplitChunksPlugin 插件可以将公共的依赖模块提取到已有的 entry chunk 中，或者提取到一个新生成的 chunk。</p>
<h3 id="3-动态导入-懒加载或者按需加载"><a href="#3-动态导入-懒加载或者按需加载" class="headerlink" title="3.动态导入(懒加载或者按需加载)"></a>3.动态导入(懒加载或者按需加载)</h3><p>当涉及到动态代码拆分时，webpack 提供了两个类似的技术。第一种，也是推荐选择的方式是，使用符合 ECMAScript 提案 的 import() 语法 来实现动态导入。第二种，则是 webpack 的遗留功能，使用 webpack 特定的 require.ensure。</p>
<h2 id="二-SplitChunksPlugin"><a href="#二-SplitChunksPlugin" class="headerlink" title="二.SplitChunksPlugin"></a>二.SplitChunksPlugin</h2><p>Webpack4.0以后，我们可谓是告别了头疼的配置问题。Webpack引入了mode的配置选项，提供’production’,’development’和’none’三种模式选择，告知 webpack 使用相应环境的内置优化。</p>
<p>当我们开启不同的模式，就意味着载入了相对的默认配置。默认情况下，mode的值为’production’。 我们可以去官网看看production模式下都有哪些默认配置。</p>
<p>production模式下，SplitChunksPlugin插件是默认被启用的，默认配置如下</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">module.exports &#x3D; &#123;</span><br><span class="line">    &#x2F;&#x2F;...</span><br><span class="line">    optimization: &#123;</span><br><span class="line">      splitChunks: &#123;</span><br><span class="line">        chunks: &#39;async&#39;,</span><br><span class="line">        minSize: 30000, &#x2F;&#x2F; 打包出的chunk最小时30kb 否则不打包</span><br><span class="line">        maxSize: 0,</span><br><span class="line">        minChunks: 1, &#x2F;&#x2F; 至少被1个module引用</span><br><span class="line">        maxAsyncRequests: 5,  &#x2F;&#x2F;  </span><br><span class="line">        maxInitialRequests: 3, &#x2F;&#x2F; 初始化时最多三个请求</span><br><span class="line">        automaticNameDelimiter: &#39;~&#39;, &#x2F;&#x2F; 名字中间的分隔符</span><br><span class="line">        name: true, &#x2F;&#x2F; chunk的名字，如果设成true，会根据被提取的chunk自动生成</span><br><span class="line">        cacheGroups: &#123;</span><br><span class="line">          vendors: &#123;</span><br><span class="line">            test: &#x2F;[\\&#x2F;]node_modules[\\&#x2F;]&#x2F;, &#x2F;&#x2F; 文件匹配规则</span><br><span class="line">            priority: -10 &#x2F;&#x2F; 优先级</span><br><span class="line">          &#125;,</span><br><span class="line">          default: &#123;</span><br><span class="line">            minChunks: 2,</span><br><span class="line">            priority: -20,</span><br><span class="line">            reuseExistingChunk: true &#x2F;&#x2F; 当module未变时，是否可以使用之前的chunk</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>一些重要的配置项：</p>
<p>chunks——表示哪些代码需要优化 有三个可选值：initial(初始块)、async(按需加载块)、all(全部块)，默认为async。<br>initial, all模式 会将所有来自node_modules的模块分配到一个叫vendors的缓存组；所有重复引用至少两次的代码，会被分配到default的缓存组。<br>initial模式下会分开优化打包异步和非异步模块。而all会把异步和非异步同时进行优化打包。<br>cacheGroups——可以自定义配置打包块<br>webpack默认的打包chunk优化，只会影响按需加载的模块，也就是说只有异步加载的模块才会有默认打包行为。（import().then()，require.ensure，react-router按需加载）</p>
<h2 id="三-Code-Splitting实现原理"><a href="#三-Code-Splitting实现原理" class="headerlink" title="三.Code Splitting实现原理"></a>三.Code Splitting实现原理</h2><p>首先我们依然创建一个简单入口模块index.js和两个依赖模块foo.js和bar.js</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F; index.js</span><br><span class="line">&#39;use strict&#39;;</span><br><span class="line">import(&#x2F;* webpackChunkName: &quot;foo&quot; *&#x2F; &#39;.&#x2F;foo&#39;).then(foo &#x3D;&gt; &#123;</span><br><span class="line">    console.log(foo());</span><br><span class="line">&#125;)</span><br><span class="line">import(&#x2F;* webpackChunkName: &quot;bar&quot; *&#x2F; &#39;.&#x2F;bar&#39;).then(bar &#x3D;&gt; &#123;</span><br><span class="line">    console.log(bar());</span><br><span class="line">&#125;)</span><br><span class="line">&#x2F;&#x2F; foo.js</span><br><span class="line">&#39;use strict&#39;;</span><br><span class="line">exports.foo &#x3D; function () &#123;</span><br><span class="line">    return 2;</span><br><span class="line">&#125;</span><br><span class="line">&#x2F;&#x2F; bar.js</span><br><span class="line">&#39;use strict&#39;;</span><br><span class="line">exports.bar &#x3D; function () &#123;</span><br><span class="line">    return 1;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>webpack配置如下</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">var path &#x3D; require(&quot;path&quot;);</span><br><span class="line"></span><br><span class="line">module.exports &#x3D; &#123;</span><br><span class="line">    entry: path.join(__dirname, &#39;index.js&#39;),</span><br><span class="line">    output: &#123;</span><br><span class="line">        path: path.join(__dirname, &#39;outs&#39;),</span><br><span class="line">        filename: &#39;index.js&#39;,</span><br><span class="line">        chunkFilename: &#39;[name].bundle.js&#39;</span><br><span class="line">    &#125;,</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>打包结果(去掉了部分注释)</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br></pre></td><td class="code"><pre><span class="line">(function(modules) &#123; &#x2F;&#x2F; webpackBootstrap</span><br><span class="line">    &#x2F;&#x2F; install a JSONP callback for chunk loading</span><br><span class="line">    var parentJsonpFunction &#x3D; window[&quot;webpackJsonp&quot;];</span><br><span class="line">    window[&quot;webpackJsonp&quot;] &#x3D; function webpackJsonpCallback(chunkIds, moreModules, executeModules) &#123;</span><br><span class="line">        &#x2F;&#x2F; add &quot;moreModules&quot; to the modules object,</span><br><span class="line">        &#x2F;&#x2F; then flag all &quot;chunkIds&quot; as loaded and fire callback</span><br><span class="line">        var moduleId, chunkId, i &#x3D; 0, resolves &#x3D; [], result;</span><br><span class="line">        for(;i &lt; chunkIds.length; i++) &#123;</span><br><span class="line">            chunkId &#x3D; chunkIds[i];</span><br><span class="line">            if(installedChunks[chunkId]) &#123;</span><br><span class="line">                resolves.push(installedChunks[chunkId][0]);</span><br><span class="line">            &#125;</span><br><span class="line">            installedChunks[chunkId] &#x3D; 0;</span><br><span class="line">        &#125;</span><br><span class="line">        for(moduleId in moreModules) &#123;</span><br><span class="line">            if(Object.prototype.hasOwnProperty.call(moreModules, moduleId)) &#123;</span><br><span class="line">                modules[moduleId] &#x3D; moreModules[moduleId];</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        if(parentJsonpFunction) parentJsonpFunction(chunkIds, moreModules, executeModules);</span><br><span class="line">        while(resolves.length) &#123;</span><br><span class="line">            resolves.shift()();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;;</span><br><span class="line">    &#x2F;&#x2F; The module cache</span><br><span class="line">    var installedModules &#x3D; &#123;&#125;;</span><br><span class="line">    &#x2F;&#x2F; objects to store loaded and loading chunks</span><br><span class="line">    var installedChunks &#x3D; &#123;</span><br><span class="line">        2: 0</span><br><span class="line">    &#125;;</span><br><span class="line">    &#x2F;&#x2F; The require function</span><br><span class="line">    function __webpack_require__(moduleId) &#123;</span><br><span class="line">        &#x2F;&#x2F; Check if module is in cache</span><br><span class="line">        if(installedModules[moduleId]) &#123;</span><br><span class="line">            return installedModules[moduleId].exports;</span><br><span class="line">        &#125;</span><br><span class="line">        &#x2F;&#x2F; Create a new module (and put it into the cache)</span><br><span class="line">        var module &#x3D; installedModules[moduleId] &#x3D; &#123;</span><br><span class="line">            i: moduleId,</span><br><span class="line">            l: false,</span><br><span class="line">            exports: &#123;&#125;</span><br><span class="line">        &#125;;</span><br><span class="line">        &#x2F;&#x2F; Execute the module function</span><br><span class="line">        modules[moduleId].call(module.exports, module, module.exports, __webpack_require__);</span><br><span class="line">        &#x2F;&#x2F; Flag the module as loaded</span><br><span class="line">        module.l &#x3D; true;</span><br><span class="line">        &#x2F;&#x2F; Return the exports of the module</span><br><span class="line">        return module.exports;</span><br><span class="line">    &#125;</span><br><span class="line">    &#x2F;&#x2F; This file contains only the entry chunk.</span><br><span class="line">    &#x2F;&#x2F; The chunk loading function for additional chunks</span><br><span class="line">    __webpack_require__.e &#x3D; function requireEnsure(chunkId) &#123;</span><br><span class="line">        var installedChunkData &#x3D; installedChunks[chunkId];</span><br><span class="line">        if(installedChunkData &#x3D;&#x3D;&#x3D; 0) &#123;</span><br><span class="line">            return new Promise(function(resolve) &#123; resolve(); &#125;);</span><br><span class="line">        &#125;</span><br><span class="line">        &#x2F;&#x2F; a Promise means &quot;currently loading&quot;.</span><br><span class="line">        if(installedChunkData) &#123;</span><br><span class="line">            return installedChunkData[2];</span><br><span class="line">        &#125;</span><br><span class="line">        &#x2F;&#x2F; setup Promise in chunk cache</span><br><span class="line">        var promise &#x3D; new Promise(function(resolve, reject) &#123;</span><br><span class="line">            installedChunkData &#x3D; installedChunks[chunkId] &#x3D; [resolve, reject];</span><br><span class="line">        &#125;);</span><br><span class="line">        installedChunkData[2] &#x3D; promise;</span><br><span class="line">        &#x2F;&#x2F; start chunk loading</span><br><span class="line">        var head &#x3D; document.getElementsByTagName(&#39;head&#39;)[0];</span><br><span class="line">        var script &#x3D; document.createElement(&#39;script&#39;);</span><br><span class="line">        script.type &#x3D; &#39;text&#x2F;javascript&#39;;</span><br><span class="line">        script.charset &#x3D; &#39;utf-8&#39;;</span><br><span class="line">        script.async &#x3D; true;</span><br><span class="line">        script.timeout &#x3D; 120000;</span><br><span class="line">        if (__webpack_require__.nc) &#123;</span><br><span class="line">            script.setAttribute(&quot;nonce&quot;, __webpack_require__.nc);</span><br><span class="line">        &#125;</span><br><span class="line">        script.src &#x3D; __webpack_require__.p + &quot;&quot; + (&#123;&quot;0&quot;:&quot;foo&quot;,&quot;1&quot;:&quot;bar&quot;&#125;[chunkId]||chunkId) + &quot;.bundle.js&quot;;</span><br><span class="line">        var timeout &#x3D; setTimeout(onScriptComplete, 120000);</span><br><span class="line">        script.onerror &#x3D; script.onload &#x3D; onScriptComplete;</span><br><span class="line">        function onScriptComplete() &#123;</span><br><span class="line">            &#x2F;&#x2F; avoid mem leaks in IE.</span><br><span class="line">            script.onerror &#x3D; script.onload &#x3D; null;</span><br><span class="line">            clearTimeout(timeout);</span><br><span class="line">            var chunk &#x3D; installedChunks[chunkId];</span><br><span class="line">            if(chunk !&#x3D;&#x3D; 0) &#123;</span><br><span class="line">                if(chunk) &#123;</span><br><span class="line">                    chunk[1](new Error(&#39;Loading chunk &#39; + chunkId + &#39; failed.&#39;));</span><br><span class="line">                &#125;</span><br><span class="line">                installedChunks[chunkId] &#x3D; undefined;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;;</span><br><span class="line">        head.appendChild(script);</span><br><span class="line">        return promise;</span><br><span class="line">    &#125;;</span><br><span class="line">    &#x2F;&#x2F; expose the modules object (__webpack_modules__)</span><br><span class="line">    __webpack_require__.m &#x3D; modules;</span><br><span class="line">    &#x2F;&#x2F; expose the module cache</span><br><span class="line">    __webpack_require__.c &#x3D; installedModules;</span><br><span class="line">    &#x2F;&#x2F; define getter function for harmony exports</span><br><span class="line">    __webpack_require__.d &#x3D; function(exports, name, getter) &#123;</span><br><span class="line">        if(!__webpack_require__.o(exports, name)) &#123;</span><br><span class="line">            Object.defineProperty(exports, name, &#123;</span><br><span class="line">                configurable: false,</span><br><span class="line">                enumerable: true,</span><br><span class="line">                get: getter</span><br><span class="line">            &#125;);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;;</span><br><span class="line">    &#x2F;&#x2F; getDefaultExport function for compatibility with non-harmony modules</span><br><span class="line">    __webpack_require__.n &#x3D; function(module) &#123;</span><br><span class="line">        var getter &#x3D; module &amp;&amp; module.__esModule ?</span><br><span class="line">            function getDefault() &#123; return module[&#39;default&#39;]; &#125; :</span><br><span class="line">            function getModuleExports() &#123; return module; &#125;;</span><br><span class="line">        __webpack_require__.d(getter, &#39;a&#39;, getter);</span><br><span class="line">        return getter;</span><br><span class="line">    &#125;;</span><br><span class="line">    &#x2F;&#x2F; Object.prototype.hasOwnProperty.call</span><br><span class="line">    __webpack_require__.o &#x3D; function(object, property) &#123; return Object.prototype.hasOwnProperty.call(object, property); &#125;;</span><br><span class="line">    &#x2F;&#x2F; __webpack_public_path__</span><br><span class="line">    __webpack_require__.p &#x3D; &quot;&quot;;</span><br><span class="line">    &#x2F;&#x2F; on error function for async loading</span><br><span class="line">    __webpack_require__.oe &#x3D; function(err) &#123; console.error(err); throw err; &#125;;</span><br><span class="line">    &#x2F;&#x2F; Load entry module and return exports</span><br><span class="line">    return __webpack_require__(__webpack_require__.s &#x3D; 0);</span><br><span class="line">&#125;)</span><br><span class="line">([</span><br><span class="line">(function(module, exports, __webpack_require__) &#123;</span><br><span class="line">    &quot;use strict&quot;;</span><br><span class="line">    __webpack_require__.e&#x2F;* import() *&#x2F;(0).then(__webpack_require__.bind(null, 1)).then(foo &#x3D;&gt; &#123;</span><br><span class="line">        console.log(foo());</span><br><span class="line">    &#125;)</span><br><span class="line">    __webpack_require__.e&#x2F;* import() *&#x2F;(1).then(__webpack_require__.bind(null, 2)).then(bar &#x3D;&gt; &#123;</span><br><span class="line">        console.log(bar());</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;)</span><br><span class="line">]);</span><br></pre></td></tr></table></figure>
<p>可以看出import()返回的是一个Promise<br>通过动态脚本的注入实现异步加载模块。<br>再通过webpackJsonp作为模块加载和执行完成的回调，从而触发import的resolve。</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2019/12/13/webpack%E5%8E%9F%E7%90%86%E6%B5%85%E6%9E%90%E4%B9%8B%E4%BB%A3%E7%A0%81%E5%88%86%E5%89%B2/" data-id="ck43m2ejh0005sf0ob8h64fdf" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-Webpack原理浅析之构建流程梳理" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2019/12/13/Webpack%E5%8E%9F%E7%90%86%E6%B5%85%E6%9E%90%E4%B9%8B%E6%9E%84%E5%BB%BA%E6%B5%81%E7%A8%8B%E6%A2%B3%E7%90%86/" class="article-date">
  <time datetime="2019-12-13T03:36:45.000Z" itemprop="datePublished">2019-12-13</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2019/12/13/Webpack%E5%8E%9F%E7%90%86%E6%B5%85%E6%9E%90%E4%B9%8B%E6%9E%84%E5%BB%BA%E6%B5%81%E7%A8%8B%E6%A2%B3%E7%90%86/">Webpack原理浅析之构建流程梳理</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>本文将带你梳理Webpack在构建过程和基本的构建原理，以及我们熟悉的loader,plugin都是怎样应用在构建流程中的。</p>
<h2 id="一-概念前置"><a href="#一-概念前置" class="headerlink" title="一.概念前置"></a>一.概念前置</h2><p>Tapable<br>Tapable是个专注一实现自定义事件的发布与订阅的一个小型库。webpack中许多重要的对象都是继承自Tapable，以便于钩入到构建过程中的的各个关键节点做出处理。可以说Tapable是webpack整个插件系统实现的基础。</p>
<p>Compiler<br>Compiler模块是 webpack 的支柱引擎，它通过 CLI 或 Node API 传递的所有选项，创建出一个 compilation 实例。它扩展(extend)自 Tapable 类，以便注册和调用插件。大多数面向用户的插件首，会先在 Compiler 上注册。</p>
<p>Compilation<br>Compilation模块会被 Compiler 用来创建新的编译（或新的构建）。  compilation 实例能够访问所有的模块和它们的依赖（大部分是循环依赖）。它会对应用程序的依赖图中所有模块进行字面上的编译(literal compilation)。在编译阶段，模块会被加载(loaded)、封存(sealed)、优化(optimized)、分块(chunked)、哈希(hashed)和重新创建(restored)。</p>
<h2 id="二-构建流程"><a href="#二-构建流程" class="headerlink" title="二.构建流程"></a>二.构建流程</h2><p>初始化阶段<br>初始化参数<br>从配置文件和 Shell 语句中读取与合并参数，得出最终的参数。<br>在这个阶段也会对合并出的配置参数进校验，校验不通过，webpack将抛出错误。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F; webpack.js</span><br><span class="line"></span><br><span class="line">&#x2F;&#x2F; 校验配置</span><br><span class="line">	const webpackOptionsValidationErrors &#x3D; validateSchema(</span><br><span class="line">		webpackOptionsSchema,</span><br><span class="line">		options</span><br><span class="line">	);</span><br><span class="line">	if (webpackOptionsValidationErrors.length) &#123;</span><br><span class="line">		throw new WebpackOptionsValidationError(webpackOptionsValidationErrors);</span><br><span class="line">	&#125;</span><br></pre></td></tr></table></figure>
<p>实例化Compiler<br>用上一步得到的参数初始化 Compiler 实例。Compiler 实例中包含了完整的 Webpack 配置，全局只有一个 Compiler 实例。<br>加载插件，配置文件中配置的插件在此时进行注册。已监听在构建过程中广播的事件。<br>内置插件的注册。<br>启动编译。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F; 实例化compiler对象</span><br><span class="line">	let compiler;</span><br><span class="line">	if (Array.isArray(options)) &#123;</span><br><span class="line">		compiler &#x3D; new MultiCompiler(options.map(options &#x3D;&gt; webpack(options)));</span><br><span class="line">	&#125; else if (typeof options &#x3D;&#x3D;&#x3D; &quot;object&quot;) &#123;</span><br><span class="line">		options &#x3D; new WebpackOptionsDefaulter().process(options);</span><br><span class="line"></span><br><span class="line">		compiler &#x3D; new Compiler(options.context);</span><br><span class="line">		compiler.options &#x3D; options;</span><br><span class="line">		new NodeEnvironmentPlugin().apply(compiler);</span><br><span class="line">		if (options.plugins &amp;&amp; Array.isArray(options.plugins)) &#123;</span><br><span class="line">			for (const plugin of options.plugins) &#123;</span><br><span class="line">				&#x2F;&#x2F; 注册配置插件的监听器 让插件可以监听到构建过程中广播的事件 并传入compiler</span><br><span class="line">				if (typeof plugin &#x3D;&#x3D;&#x3D; &quot;function&quot;) &#123;</span><br><span class="line">					plugin.call(compiler, compiler);</span><br><span class="line">				&#125; else &#123;</span><br><span class="line">					plugin.apply(compiler);</span><br><span class="line">				&#125;</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">		compiler.hooks.environment.call();</span><br><span class="line">		compiler.hooks.afterEnvironment.call();</span><br><span class="line">		compiler.options &#x3D; new WebpackOptionsApply().process(options, compiler);</span><br><span class="line">	&#125; else &#123;</span><br><span class="line">		throw new Error(&quot;Invalid argument: options&quot;);</span><br><span class="line">	&#125;</span><br><span class="line">	if (callback) &#123;</span><br><span class="line">		if (typeof callback !&#x3D;&#x3D; &quot;function&quot;) &#123;</span><br><span class="line">			throw new Error(&quot;Invalid argument: callback&quot;);</span><br><span class="line">		&#125;</span><br><span class="line">		&#x2F;&#x2F; 监听文件变更</span><br><span class="line">		if (</span><br><span class="line">			options.watch &#x3D;&#x3D;&#x3D; true ||</span><br><span class="line">			(Array.isArray(options) &amp;&amp; options.some(o &#x3D;&gt; o.watch))</span><br><span class="line">		) &#123;</span><br><span class="line">			const watchOptions &#x3D; Array.isArray(options)</span><br><span class="line">				? options.map(o &#x3D;&gt; o.watchOptions || &#123;&#125;)</span><br><span class="line">				: options.watchOptions || &#123;&#125;;</span><br><span class="line">			return compiler.watch(watchOptions, callback);</span><br><span class="line">		&#125;</span><br><span class="line">		&#x2F;&#x2F; 开始编译</span><br><span class="line">		compiler.run(callback);</span><br><span class="line">	&#125;</span><br><span class="line">&#96;&#96;&#96;    </span><br><span class="line">编译阶段  </span><br><span class="line">这个阶段主要是Compile创建出一个Compilation实例，开始一次编译。在Compile上主要会广播出一下事件节点。</span><br><span class="line"></span><br><span class="line">run：启动一次新的编译。  </span><br><span class="line">watch-run：和 run 类似，区别在于它是在监听模式下启动的编译，在这个事件中可以获取到是哪些文件发生了变化导致重新启动一次新的编译。  </span><br><span class="line">compile：该事件是为了告诉插件一次新的编译将要启动，同时会给插件带上 compiler 对象。  </span><br><span class="line">compilation： 当 Webpack 以开发模式运行时，每当检测到文件变化，一次新的 Compilation 将被创建。一个 Compilation 对象包含了当前的模块资源、编译生成资源、变化的文件等。Compilation 对象也提供了很多事件回调供插件做扩展。</span><br><span class="line">make：一个新的 Compilation 创建完毕，即将从 Entry 开始读取文件，根据文件类型和配置的 Loader 对文件进行编译，编译完后再找出该文件依赖的文件，递归的编译和解析。  </span><br><span class="line">after-compile：一次 Compilation 执行完成。  </span><br><span class="line">invalid：当遇到文件不存在、文件编译错误等异常时会触发该事件，该事件不会导致 Webpack 退出。  </span><br><span class="line">Compile是存在与整个webpack的生命周期当中，负责全局的调度。真正的一次编译的执行，是由Compilation进行的，Compilation阶段包含的事件有：  </span><br><span class="line"></span><br><span class="line">build-module：使用对应的 Loader 去转换一个模块。  </span><br><span class="line">normal-module-loader：在用 Loader 对一个模块转换完后，使用 acorn 解析转换后的内容，输出对应的抽象语法树（AST），以方便 Webpack 后面对代码的分析。</span><br><span class="line">program：从配置的入口模块开始，分析其 AST，当遇到 require 等导入其它模块语句时，便将其加入到依赖的模块列表，同时对新找出的依赖模块递归分析，最终搞清所有模块的依赖关系。  </span><br><span class="line">seal： 所有模块及其依赖的模块都通过 Loader 转换完成后，根据依赖关系开始生成 Chunk。  </span><br><span class="line">输出阶段  </span><br><span class="line">这一阶段可以理解为一次编译结束，Compilation的任务结束，所以控制权又交到了Compile。  </span><br><span class="line"></span><br><span class="line">shouldEmit：所有需要输出的文件已经生成好，询问插件哪些文件需要输出，哪些不需要。  </span><br><span class="line">emit： 确定好要输出哪些文件后，执行文件输出，可以在这里获取和修改输出内容。</span><br><span class="line">afterEmit： 文件输出完毕。  </span><br><span class="line">done： 成功完成一次完成的编译和输出流程。  </span><br><span class="line">failed：如果在编译和输出流程中遇到异常导致 Webpack 退出时，就会直接跳转到本步骤，插件可以在本事件中获取到具体的错误原因。  </span><br><span class="line">## 三.输出结果分析</span><br><span class="line">[https:&#x2F;&#x2F;github.com&#x2F;ReedSun&#x2F;analysis-bundle.js-of-Webpack&#x2F;blob&#x2F;master&#x2F;dist&#x2F;bundle.js]()</span><br><span class="line"></span><br><span class="line">## 四.如何写一个loader</span><br><span class="line">1. loader单一职责</span><br><span class="line">loader用于将各种类型的文件转换为Webpack能识别的文件类型，也是webpack敢号称‘打包一切’的原因。</span><br><span class="line">loader的关键在于职责单一，只完成一种转换，这样才有助与我们组合各种loader得到我们想要的转换结果过。比如一处理scss文件为例，</span><br><span class="line"></span><br><span class="line">代码会先交给 sass-loader 把 SCSS 转换成 CSS</span><br><span class="line">把 sass-loader 输出的 CSS 交给 css-loader 处理，找出 CSS 中依赖的资源、压缩 CSS 等；</span><br><span class="line">把 css-loader 输出的 CSS 交给 style-loader 处理，转换成通过脚本加载的 JavaScript 代码；</span><br><span class="line">2. loader本质是一个npm包</span><br><span class="line">loader本质是node模块，这个模块需要导出一个函数。在开发loader时，你只需关心输入和输出。</span><br></pre></td></tr></table></figure>
<p>module.exports = function(source) {<br> // source 为 compiler 传递给 Loader 的一个文件的原内容<br> // ….<br> return result;<br>}<br>由于 Loader 运行在 Node.js 中，你可以调用任何 Node.js 自带的 API，或者安装第三方模块进行调用.</p>
<p>const sass = require(‘node-sass’);<br>module.exports = function(source) {<br>  return sass(source);<br>};</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">3.本地调试loader  </span><br><span class="line">在开发 Loader 的过程中，为了测试编写的 Loader 是否能正常工作，需要把它配置到 Webpack 中后，才可能会调用该 Loader。 在开发过程中使用的 Loader 都是通过 Npm 安装的，要使用 Loader 时会直接使用 Loader 的名称。</span><br><span class="line">如果还采取以上的方法去使用本地开发的 Loader 将会很麻烦，因为你需要确保编写的 Loader 的源码是在 node_modules 目录下。 为此你需要先把编写的 Loader 发布到 Npm 仓库后再安装到本地项目使用。</span><br><span class="line">解决以上问题的便捷方法有两种，分别如下：</span><br><span class="line"></span><br><span class="line">Npm link：Npm link 专门用于开发和调试本地 Npm 模块，能做到在不发布模块的情况下，把本地的一个正在开发的模块的源码链接到项目的 node_modules 目录下，让项目可以直接使用本地的 Npm 模块。</span><br><span class="line">ResolveLoader：ResolveLoader 用于配置 Webpack 如何寻找 Loader。 默认情况下只会去 node_modules 目录下寻找，为了让 Webpack 加载放在本地项目中的 Loader 需要修改 resolveLoader.modules。</span><br><span class="line">五.如何写一个plugin</span><br><span class="line">在 Webpack 运行的生命周期中会广播出许多事件，Plugin 可以监听这些事件，在合适的时机通过 Webpack 提供的 API 改变输出结果。</span><br></pre></td></tr></table></figure>
<p>// 一个基础的plugin</p>
<pre><code>class BasicPlugin{
    // 在构造函数中获取用户给该插件传入的配置
    constructor(options){
    }

    // Webpack 会调用 BasicPlugin 实例的 apply 方法给插件实例传入 compiler 对象
    apply(compiler){
        compiler.plugin(&apos;compilation&apos;,function(compilation) {
            // 在插件中compiler和compilation我们都可以访问的到

        })
    }
}

// 导出 Plugin
module.exports = BasicPlugin;</code></pre><p>事件流机制<br>Compiler 和 Compilation 都继承自 Tapable，可以直接在 Compiler 和 Compilation 对象上广播和监听事件，方法如下：<br>/**</p>
<ul>
<li>广播出事件</li>
<li>event-name 为事件名称，注意不要和现有的事件重名</li>
<li>params 为附带的参数</li>
<li>/<br>compiler.apply(‘event-name’,params);</li>
</ul>
<p>/**</p>
<ul>
<li>监听名称为 event-name 的事件，当 event-name 事件发生时，函数就会被执行。</li>
<li>同时函数中的 params 参数为广播事件时附带的参数。</li>
<li>/<br>compiler.plugin(‘event-name’,function(params) {</li>
</ul>
<p>});</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">在开发插件时，还需要注意以下几点：  </span><br><span class="line">只要能拿到 Compiler 或 Compilation 对象，就能广播出新的事件，所以在新开发的插件中也能广播出事件，给其它插件监听使用。  </span><br><span class="line">传给每个插件的 Compiler 和 Compilation 对象都是同一个引用。也就是说在一个插件中修改了 Compiler 或 Compilation 对象上的属性，会影响到后面的插件。</span><br><span class="line">有些事件是异步的，这些异步的事件会附带两个参数，第二个参数为回调函数，在插件处理完任务时需要调用回调函数通知 Webpack，才会进入下一处理流程。例如：</span><br></pre></td></tr></table></figure>
<p>compiler.plugin(‘emit’,function(compilation, callback) {<br>   // 支持处理逻辑</p>
<p>   // 处理完毕后执行 callback 以通知 Webpack<br>   // 如果不执行 callback，运行流程将会一直卡在这不往下执行<br>   callback();<br> });</p>
<pre><code>[https://juejin.im/entry/5b0e3eba5188251534379615]()


</code></pre>
      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2019/12/13/Webpack%E5%8E%9F%E7%90%86%E6%B5%85%E6%9E%90%E4%B9%8B%E6%9E%84%E5%BB%BA%E6%B5%81%E7%A8%8B%E6%A2%B3%E7%90%86/" data-id="ck43m2ej90000sf0od0t6gte8" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-Webpack原理浅析之HMR" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2019/12/13/Webpack%E5%8E%9F%E7%90%86%E6%B5%85%E6%9E%90%E4%B9%8BHMR/" class="article-date">
  <time datetime="2019-12-13T03:36:08.000Z" itemprop="datePublished">2019-12-13</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2019/12/13/Webpack%E5%8E%9F%E7%90%86%E6%B5%85%E6%9E%90%E4%B9%8BHMR/">Webpack原理浅析之HMR</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p><a href="">https://zhuanlan.zhihu.com/p/30669007</a></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2019/12/13/Webpack%E5%8E%9F%E7%90%86%E6%B5%85%E6%9E%90%E4%B9%8BHMR/" data-id="ck43m2ejd0001sf0of88a6xue" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-requestAnimationFrame和requestIdleCallback小记" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2019/12/13/requestAnimationFrame%E5%92%8CrequestIdleCallback%E5%B0%8F%E8%AE%B0/" class="article-date">
  <time datetime="2019-12-13T03:34:05.000Z" itemprop="datePublished">2019-12-13</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2019/12/13/requestAnimationFrame%E5%92%8CrequestIdleCallback%E5%B0%8F%E8%AE%B0/">requestAnimationFrame和requestIdleCallback小记</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>在学习react fibber中了解到fibber实现主要就是利用requestAnimation和requestIdleCallback这两个api，本文主要就是简单的总结下这两个api。</p>
<h2 id="一-window-requestAnimationFrame"><a href="#一-window-requestAnimationFrame" class="headerlink" title="一. window.requestAnimationFrame"></a>一. window.requestAnimationFrame</h2><p>说到实现动画效果，requestAnimationFrame一定是出现在脑海里的第一个词。相比于setTimeOut来实现动画时间间隔的不可控制，丢帧现象的普遍。requestAnimationFrame要求浏览器在下次重绘之前调用指定的回调函数更新动画。也就是说他的回调执行的频率是和系统的帧率保持一致的（大约60Hz左右）。它就像是浏览器专门为我们实现动画效果开的绿色通道。</p>
<h2 id="二-window-requestIdleCallback"><a href="#二-window-requestIdleCallback" class="headerlink" title="二. window.requestIdleCallback"></a>二. window.requestIdleCallback</h2><p>我们都知道页面是一帧一帧渲染出来的，每秒60帧刚好是一个人视觉上流畅的帧率，小于这个值时，用户就会感觉到页面卡顿，也就是每一帧分到的时间是（1/60）s,约16ms。当每一帧的任务执行时间超过16ms就会出现卡顿现象。</p>
<p>浏览器每一帧需要做的工作大概是</p>
<ul>
<li>处理用户交互</li>
<li>js解析执行</li>
<li>帧开始。窗口尺寸变更，页面滚动处理等</li>
<li>requestAnimationFrame</li>
<li>Layout</li>
<li>Paint<br>在两个执行帧之间，浏览器通常有一小段空闲时间，requestIdleCallback可以在这个空闲期（Idle Period）调用空闲期回调（Idle Callback），执行一些任务。</li>
</ul>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2019/12/13/requestAnimationFrame%E5%92%8CrequestIdleCallback%E5%B0%8F%E8%AE%B0/" data-id="ck43m2eje0002sf0ocejs39ti" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-react学习链接" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2019/12/13/react%E5%AD%A6%E4%B9%A0%E9%93%BE%E6%8E%A5/" class="article-date">
  <time datetime="2019-12-13T03:31:27.000Z" itemprop="datePublished">2019-12-13</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2019/12/13/react%E5%AD%A6%E4%B9%A0%E9%93%BE%E6%8E%A5/">react学习链接</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p><a href="">https://github.com/facebook/react/tree/master/packages</a></p>
<p><a href="">https://juejin.im/post/5983dfbcf265da3e2f7f32de</a></p>
<p><a href="">https://zhuanlan.zhihu.com/p/33933582</a></p>
<p><a href="">https://zhuanlan.zhihu.com/p/58863799</a></p>
<p><a href="">https://juejin.im/post/5ab7b3a2f265da2378403e57</a></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2019/12/13/react%E5%AD%A6%E4%B9%A0%E9%93%BE%E6%8E%A5/" data-id="ck43m2ejf0003sf0o01umgfoc" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-webpack非官方学习文档" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2019/12/13/webpack%E9%9D%9E%E5%AE%98%E6%96%B9%E5%AD%A6%E4%B9%A0%E6%96%87%E6%A1%A3/" class="article-date">
  <time datetime="2019-12-13T03:24:00.000Z" itemprop="datePublished">2019-12-13</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2019/12/13/webpack%E9%9D%9E%E5%AE%98%E6%96%B9%E5%AD%A6%E4%B9%A0%E6%96%87%E6%A1%A3/">webpack非官方学习文档</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>Webpack 是一个JavaScript模块打包器，在 Webpack 里一切文件皆模块，通过 Loader 转换文件，通过 Plugin 注入钩子，最后输出由多个模块组合成的文件。Webpack 专注于构建模块化项目。</p>
<h2 id="一-前端构建工具的发展"><a href="#一-前端构建工具的发展" class="headerlink" title="一.前端构建工具的发展"></a>一.前端构建工具的发展</h2><p>前端技术的发展伴随着各种可以提高开发效率的新思想和框架被发明。但是这些东西都有一个共同点：源代码无法直接运行，必须通过转换后才可以正常运行。<br>构建就是做这件事情，把源代码转换成发布到线上的可执行 JavaScrip、CSS、HTML 代码，包括如下内容。  </p>
<p>代码转换：TypeScript 编译成 JavaScript、SCSS 编译成 CSS 等。<br>文件优化：压缩 JavaScript、CSS、HTML 代码，压缩合并图片等。<br>代码分割：提取多个页面的公共代码、提取首屏不需要执行部分的代码让其异步加载。<br>模块合并：在采用模块化的项目里会有很多个模块和文件，需要构建功能把模块分类合并成一个文件。<br>自动刷新：监听本地源代码的变化，自动重新构建、刷新浏览器。<br>代码校验：在代码被提交到仓库前需要校验代码是否符合规范，以及单元测试是否通过。<br>自动发布：更新完代码后，自动构建出线上发布代码并传输给发布系统。<br>构建其实是工程化、自动化思想在前端开发中的体现，把一系列流程用代码去实现，让代码自动化地执行这一系列复杂的流程。 构建给前端开发注入了更大的活力，解放了我们的生产力。</p>
<p>Npm Script 和 Grunt 时代：Web 开发要做的事情变多，流程复杂，自动化思想被引入，用于简化流程。<br>Gulp 时代：开始出现一些新语言用于提高开发效率，流式处理思想的出现是为了简化文件转换的流程，例如将 ES6 转换成 ES5。<br>Webpack 时代：由于单页应用的流行，一个网页的功能和实现代码变得庞大，Web 开发向模块化改进。</p>
<h2 id="二-webpack-配置"><a href="#二-webpack-配置" class="headerlink" title="二.webpack 配置"></a>二.webpack 配置</h2><p>想让源文件加入到构建流程中去被 Webpack 控制，配置 entry。<br>想自定义输出文件的位置和名称，配置 output。<br>想自定义寻找依赖模块时的策略，配置 resolve。<br>想自定义解析和转换文件的策略，配置 module，通常是配置 module.rules 里的 Loader。<br>其它的大部分需求可能要通过 Plugin 去实现，配置 plugin。</p>
<h2 id="三-浅析webpack构建原理"><a href="#三-浅析webpack构建原理" class="headerlink" title="三.浅析webpack构建原理"></a>三.浅析webpack构建原理</h2><p>webpack是用 Node.js 开发的。<br>Webpack 本质上是一种事件流的机制，它的工作流程就是将各个插件串联起来，而实现这一切的核心就是 tapable。webpack中最核心的Compiler和Compilation都是Tapable的实例。tapable是一个专注于自定义事件的库。在整个构建的生命周期中，webpack会在关键阶段暴露出一些钩子函数，也就是触发一些特定的事件，插件的原理就是 钩入(hook) 到在每个编译(compilation)中触发的关键事件。<br>webpack另一个重要的部分就是loader，webpack之所以号称能够打包一切也是因为loader机制。loader 让 webpack 能够去处理那些非 JavaScript 文件（webpack 自身只理解 JavaScript）。loader 可以将所有类型的文件转换为 webpack 能够处理的有效模块，然后你就可以利用 webpack 的打包能力，对它们进行处理。</p>
<h2 id="构建过程"><a href="#构建过程" class="headerlink" title="构建过程"></a>构建过程</h2>
      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2019/12/13/webpack%E9%9D%9E%E5%AE%98%E6%96%B9%E5%AD%A6%E4%B9%A0%E6%96%87%E6%A1%A3/" data-id="ck43m2ejh0006sf0o73h474bg" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-小程序笔记" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2019/12/13/%E5%B0%8F%E7%A8%8B%E5%BA%8F%E7%AC%94%E8%AE%B0/" class="article-date">
  <time datetime="2019-12-13T03:22:45.000Z" itemprop="datePublished">2019-12-13</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2019/12/13/%E5%B0%8F%E7%A8%8B%E5%BA%8F%E7%AC%94%E8%AE%B0/">小程序笔记</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="小程序技术发展史"><a href="#小程序技术发展史" class="headerlink" title="小程序技术发展史"></a>小程序技术发展史</h2><ul>
<li>微信中的WebView 逐渐成为移动 Web 的一个重要入口，微信提供相应的 JS API，仅内部使用。</li>
<li>对外发布一整套网页开发工具包，JS-SDK（类似于hysdk吧，可以调用一些原生功能）。但是，JS-SDK仍然没有解决移动网页遇到的体验不良的问题，比如白屏，页面切换的生硬和点击的迟滞感等问题。</li>
<li>小程序生态。快速的加载 ，更强大的能力， 原生的体验 ，易用且安全的微信数据开放， 高效和简单的开发。</li>
</ul>
<h2 id="微信小程序和普通的hybrid应用有什么区别"><a href="#微信小程序和普通的hybrid应用有什么区别" class="headerlink" title="微信小程序和普通的hybrid应用有什么区别"></a>微信小程序和普通的hybrid应用有什么区别</h2><p>runtime差异，小程序的环境就是开发者所能接触到的最底层环境，开发者只能依赖于小程序给大家提供的环境，而这个环境再下层如何处理，并不受开发者控制。这意味小程序的开发并不依赖 webview，开发的目标平台也不是 webview，即使目前小程序最底层的实现还是使用webview渲染，但这一层对于开发者是透明的。<br>客户端开发的核心是通过 runtime 来调度和控制 runtime 之下的平台能力，浏览器这个 runtime 下面的平台是操作系统（Windows、macOS、iOS、Android、*nix 等），而小程序这个 runtime 下面的平台是微信，这是二者的本质区别。</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2019/12/13/%E5%B0%8F%E7%A8%8B%E5%BA%8F%E7%AC%94%E8%AE%B0/" data-id="ck43l718h0000cv0o1gzfcinx" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-JSBridge通信原理" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2019/12/13/JSBridge%E9%80%9A%E4%BF%A1%E5%8E%9F%E7%90%86/" class="article-date">
  <time datetime="2019-12-13T03:20:14.000Z" itemprop="datePublished">2019-12-13</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2019/12/13/JSBridge%E9%80%9A%E4%BF%A1%E5%8E%9F%E7%90%86/">JSBridge通信原理</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">(function () &#123;</span><br><span class="line">    var id &#x3D; 0,</span><br><span class="line">        callbacks &#x3D; &#123;&#125;,</span><br><span class="line">        registerFuncs &#x3D; &#123;&#125;;</span><br><span class="line"></span><br><span class="line">    window.JSBridge &#x3D; &#123;</span><br><span class="line">        &#x2F;&#x2F; 调用 Native</span><br><span class="line">        invoke: function(bridgeName, callback, data) &#123;</span><br><span class="line">            &#x2F;&#x2F; 判断环境，获取不同的 nativeBridge</span><br><span class="line">            var thisId &#x3D; id ++; &#x2F;&#x2F; 获取唯一 id</span><br><span class="line">            callbacks[thisId] &#x3D; callback; &#x2F;&#x2F; 存储 Callback    </span><br><span class="line">            nativeBridge.postMessage(&#123;</span><br><span class="line">                bridgeName: bridgeName,</span><br><span class="line">                data: data || &#123;&#125;,</span><br><span class="line">                callbackId: thisId &#x2F;&#x2F; 传到 Native 端</span><br><span class="line">            &#125;);</span><br><span class="line">        &#125;,</span><br><span class="line">        receiveMessage: function(msg) &#123;</span><br><span class="line">            var bridgeName &#x3D; msg.bridgeName,</span><br><span class="line">                data &#x3D; msg.data || &#123;&#125;,</span><br><span class="line">                callbackId &#x3D; msg.callbackId, &#x2F;&#x2F; Native 将 callbackId 原封不动传回</span><br><span class="line">                responstId &#x3D; msg.responstId;</span><br><span class="line">            &#x2F;&#x2F; 具体逻辑</span><br><span class="line">            &#x2F;&#x2F; bridgeName 和 callbackId 不会同时存在</span><br><span class="line">            if (callbackId) &#123;</span><br><span class="line">                if (callbacks[callbackId]) &#123; &#x2F;&#x2F; 找到相应句柄</span><br><span class="line">                    callbacks[callbackId](msg.data); &#x2F;&#x2F; 执行调用</span><br><span class="line">                &#125;</span><br><span class="line">            &#125; else if (bridgeName) &#123;</span><br><span class="line">                if (registerFuncs[bridgeName]) &#123; &#x2F;&#x2F; 通过 bridgeName 找到句柄</span><br><span class="line">                    var ret &#x3D; &#123;&#125;,</span><br><span class="line">                        flag &#x3D; false;</span><br><span class="line">                    registerFuncs[bridgeName].forEach(function(callback) &#x3D;&gt; &#123;</span><br><span class="line">                        callback(data, function(r) &#123;</span><br><span class="line">                            flag &#x3D; true;</span><br><span class="line">                            ret &#x3D; Object.assign(ret, r);</span><br><span class="line">                        &#125;);</span><br><span class="line">                    &#125;);</span><br><span class="line">                    if (flag) &#123;</span><br><span class="line">                        nativeBridge.postMessage(&#123; &#x2F;&#x2F; 回调 Native</span><br><span class="line">                            responstId: responstId,</span><br><span class="line">                            ret: ret</span><br><span class="line">                        &#125;);</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;,</span><br><span class="line">        register: function(bridgeName, callback) &#123;</span><br><span class="line">            if (!registerFuncs[bridgeName])  &#123;</span><br><span class="line">                registerFuncs[bridgeName] &#x3D; [];</span><br><span class="line">            &#125;</span><br><span class="line">            registerFuncs[bridgeName].push(callback); &#x2F;&#x2F; 存储回调</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;;</span><br><span class="line">&#125;)();</span><br></pre></td></tr></table></figure>
      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2019/12/13/JSBridge%E9%80%9A%E4%BF%A1%E5%8E%9F%E7%90%86/" data-id="ck43l3pvd00000v0obemsdjqk" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-helloworld" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2019/12/13/helloworld/" class="article-date">
  <time datetime="2019-12-13T03:06:17.000Z" itemprop="datePublished">2019-12-13</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2019/12/13/helloworld/">helloworld</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        
      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2019/12/13/helloworld/" data-id="ck43kl94g0000de0odmaa3xrj" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  


  <nav id="page-nav">
    
    <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><a class="extend next" rel="next" href="/page/2/">Next &amp;raquo;</a>
  </nav>

</section>
        
          <aside id="sidebar">
  
    

  
    

  
    
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/12/">December 2019</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recent Posts</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2019/12/13/webpack%E5%8E%9F%E7%90%86%E6%B5%85%E6%9E%90%E4%B9%8B%E6%89%93%E5%8C%85%E4%BC%98%E5%8C%96/">webpack原理浅析之打包优化</a>
          </li>
        
          <li>
            <a href="/2019/12/13/webpack%E5%8E%9F%E7%90%86%E6%B5%85%E6%9E%90%E4%B9%8B%E4%BB%A3%E7%A0%81%E5%88%86%E5%89%B2/">webpack原理浅析之代码分割</a>
          </li>
        
          <li>
            <a href="/2019/12/13/Webpack%E5%8E%9F%E7%90%86%E6%B5%85%E6%9E%90%E4%B9%8B%E6%9E%84%E5%BB%BA%E6%B5%81%E7%A8%8B%E6%A2%B3%E7%90%86/">Webpack原理浅析之构建流程梳理</a>
          </li>
        
          <li>
            <a href="/2019/12/13/Webpack%E5%8E%9F%E7%90%86%E6%B5%85%E6%9E%90%E4%B9%8BHMR/">Webpack原理浅析之HMR</a>
          </li>
        
          <li>
            <a href="/2019/12/13/requestAnimationFrame%E5%92%8CrequestIdleCallback%E5%B0%8F%E8%AE%B0/">requestAnimationFrame和requestIdleCallback小记</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2019 zhoujie<br>
      Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>
    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    

<script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>


  
<link rel="stylesheet" href="/fancybox/jquery.fancybox.css">

  
<script src="/fancybox/jquery.fancybox.pack.js"></script>




<script src="/js/script.js"></script>




  </div>
</body>
</html>